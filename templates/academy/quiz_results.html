{% extends "base.html" %}

{% block title %}Quiz Results - {{ quiz.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/academy.css') }}">
<style>
    .results-page {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .results-header {
        text-align: center;
        padding: 3rem 2rem;
        border-radius: 20px;
        margin-bottom: 2rem;
    }
    
    .results-header.passed {
        background: linear-gradient(135deg, #dcfce7, #bbf7d0);
    }
    
    .results-header.failed {
        background: linear-gradient(135deg, #fee2e2, #fecaca);
    }
    
    .result-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
    }
    
    .passed .result-icon {
        background: #00d4aa;
        color: #fff;
    }
    
    .failed .result-icon {
        background: #ef4444;
        color: #fff;
    }
    
    .results-header h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .passed h1 { color: #166534; }
    .failed h1 { color: #991b1b; }
    
    .results-header p {
        font-size: 1.1rem;
    }
    
    .passed p { color: #15803d; }
    .failed p { color: #b91c1c; }
    
    .score-display {
        font-size: 4rem;
        font-weight: 700;
        margin: 1rem 0;
    }
    
    .passed .score-display { color: #00d4aa; }
    .failed .score-display { color: #ef4444; }
    
    .score-details {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1.5rem;
    }
    
    .score-detail {
        text-align: center;
    }
    
    .score-detail-value {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1a1a2e;
    }
    
    .score-detail-label {
        font-size: 0.85rem;
        color: #666;
    }
    
    .questions-review {
        background: #fff;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .questions-review h2 {
        font-size: 1.25rem;
        margin-bottom: 1.5rem;
        color: #1a1a2e;
    }
    
    .question-result {
        padding: 1.25rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        border-left: 4px solid;
    }
    
    .question-result.correct {
        background: #f0fdf4;
        border-color: #00d4aa;
    }
    
    .question-result.incorrect {
        background: #fef2f2;
        border-color: #ef4444;
    }
    
    .question-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    .correct .question-status { color: #166534; }
    .incorrect .question-status { color: #991b1b; }
    
    .question-text {
        font-size: 1rem;
        color: #1a1a2e;
        margin-bottom: 1rem;
        line-height: 1.5;
    }
    
    .answer-info {
        font-size: 0.9rem;
        color: #555;
    }
    
    .answer-info strong {
        color: #1a1a2e;
    }
    
    .your-answer {
        margin-bottom: 0.5rem;
    }
    
    .correct-answer {
        color: #166534;
    }
    
    .explanation {
        margin-top: 1rem;
        padding: 0.75rem;
        background: rgba(0,0,0,0.03);
        border-radius: 8px;
        font-size: 0.9rem;
        color: #555;
    }
    
    .explanation strong {
        color: #1a1a2e;
    }
    
    .results-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
    }
    
    .btn-action {
        padding: 0.875rem 1.5rem;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s;
    }
    
    .btn-continue {
        background: linear-gradient(135deg, #00d4aa, #00a8cc);
        color: #fff;
    }
    
    .btn-continue:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,212,170,0.4);
    }
    
    .btn-retry {
        background: #f5f5f5;
        color: #333;
    }
    
    .btn-retry:hover {
        background: #e5e5e5;
    }
</style>
{% endblock %}

{% block content %}
<div class="results-page">
    <div class="results-header {{ 'passed' if attempt.passed else 'failed' }}">
        <div class="result-icon">
            {% if attempt.passed %}
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            {% else %}
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            {% endif %}
        </div>
        
        <h1>{{ 'Congratulations!' if attempt.passed else 'Keep Learning!' }}</h1>
        <p>{{ 'You passed the quiz!' if attempt.passed else 'You need ' + quiz.passing_score|string + '% to pass.' }}</p>
        
        <div class="score-display">{{ attempt.score|int }}%</div>
        
        <div class="score-details">
            <div class="score-detail">
                <div class="score-detail-value">{{ attempt.points_earned }}/{{ attempt.total_points }}</div>
                <div class="score-detail-label">Points Earned</div>
            </div>
            <div class="score-detail">
                <div class="score-detail-value">{{ results|selectattr('is_correct')|list|length }}/{{ results|length }}</div>
                <div class="score-detail-label">Correct Answers</div>
            </div>
            {% if attempt.time_taken_seconds %}
            <div class="score-detail">
                <div class="score-detail-value">{{ (attempt.time_taken_seconds / 60)|int }}:{{ '%02d'|format(attempt.time_taken_seconds % 60) }}</div>
                <div class="score-detail-label">Time Taken</div>
            </div>
            {% endif %}
        </div>
    </div>

    {% if quiz.show_correct_answers %}
    <div class="questions-review">
        <h2>Review Your Answers</h2>
        
        {% for result in results %}
        <div class="question-result {{ 'correct' if result.is_correct else 'incorrect' }}">
            <div class="question-status">
                {% if result.is_correct %}
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                Correct
                {% else %}
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
                Incorrect
                {% endif %}
            </div>
            
            <p class="question-text">{{ result.question.question_text }}</p>
            
            <div class="answer-info">
                {% if result.user_answer is not none %}
                <p class="your-answer">
                    <strong>Your answer:</strong> 
                    {% if result.question.question_type in ['multiple_choice', 'true_false'] %}
                        {{ result.options[result.user_answer|int].text if result.user_answer|int < result.options|length else 'N/A' }}
                    {% else %}
                        {{ result.user_answer }}
                    {% endif %}
                </p>
                {% else %}
                <p class="your-answer"><strong>Your answer:</strong> Not answered</p>
                {% endif %}
                
                {% if not result.is_correct %}
                <p class="correct-answer">
                    <strong>Correct answer:</strong>
                    {% if result.question.question_type in ['multiple_choice', 'true_false'] %}
                        {% for opt in result.options %}
                            {% if opt.is_correct %}{{ opt.text }}{% endif %}
                        {% endfor %}
                    {% else %}
                        {{ result.question.correct_answer }}
                    {% endif %}
                </p>
                {% endif %}
            </div>
            
            {% if result.question.explanation %}
            <div class="explanation">
                <strong>Explanation:</strong> {{ result.question.explanation }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="results-actions">
        <a href="{{ url_for('academy.learn', slug=lesson.course.slug, lesson=lesson.id) }}" class="btn-action btn-continue">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
            Continue Learning
        </a>
        {% if not attempt.passed %}
        <a href="{{ url_for('academy.take_quiz', quiz_id=quiz.id) }}" class="btn-action btn-retry">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/>
            </svg>
            Try Again
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}

