{% extends "base.html" %}

{% block title %}Manage Lessons - {{ course.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/academy.css') }}">
{% endblock %}

{% block content %}
<div class="admin-page">
    <div class="admin-header">
        <a href="{{ url_for('academy.edit_course', course_id=course.id) }}" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Back to Course
        </a>
        <h1>{{ course.title }} - Lessons</h1>
    </div>

    <div class="lessons-layout">
        <!-- Add Lesson Form -->
        <div class="add-lesson-card">
            <h3>Add New Lesson</h3>
            <form method="POST" class="lesson-form">
                <div class="form-group">
                    <label for="title">Lesson Title *</label>
                    <input type="text" id="title" name="title" required placeholder="e.g., Introduction to Budgeting">
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="2" placeholder="Brief description of this lesson"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="content_type">Content Type</label>
                        <select id="content_type" name="content_type">
                            <option value="video">Video</option>
                            <option value="text">Text/Article</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="duration_minutes">Duration (minutes)</label>
                        <input type="number" id="duration_minutes" name="duration_minutes" min="0" value="10">
                    </div>
                </div>

                <div class="form-group video-fields">
                    <label for="video_url">Video URL</label>
                    <input type="url" id="video_url" name="video_url" placeholder="YouTube or Vimeo URL">
                </div>

                <div class="form-group video-fields">
                    <label for="video_provider">Video Provider</label>
                    <select id="video_provider" name="video_provider">
                        <option value="youtube">YouTube</option>
                        <option value="vimeo">Vimeo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="is_free_preview">
                        Free Preview (viewable without enrollment)
                    </label>
                </div>

                <button type="submit" class="btn-add-lesson">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Add Lesson
                </button>
            </form>
        </div>

        <!-- Lessons List -->
        <div class="lessons-list-card">
            <h3>Course Lessons ({{ lessons|length }})</h3>
            
            {% if lessons %}
            <div class="lessons-list">
                {% for lesson in lessons %}
                <div class="lesson-item" data-id="{{ lesson.id }}">
                    <div class="lesson-drag">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
                        </svg>
                    </div>
                    <div class="lesson-number">{{ loop.index }}</div>
                    <div class="lesson-info">
                        <h4>{{ lesson.title }}</h4>
                        <div class="lesson-meta">
                            <span class="type">{{ lesson.content_type|title }}</span>
                            <span class="duration">{{ lesson.duration_minutes }} min</span>
                            {% if lesson.is_free_preview %}
                            <span class="preview-badge">Free Preview</span>
                            {% endif %}
                            {% if not lesson.is_published %}
                            <span class="draft-badge">Draft</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="lesson-actions">
                        <a href="{{ url_for('academy.edit_lesson', lesson_id=lesson.id) }}" class="action-btn" title="Edit">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </a>
                        <form action="{{ url_for('academy.delete_lesson', lesson_id=lesson.id) }}" method="POST" 
                              onsubmit="return confirm('Are you sure you want to delete this lesson?');">
                            <button type="submit" class="action-btn delete" title="Delete">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                </svg>
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-lessons">
                <p>No lessons yet. Add your first lesson above!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.getElementById('content_type').addEventListener('change', function() {
    const videoFields = document.querySelectorAll('.video-fields');
    if (this.value === 'video') {
        videoFields.forEach(f => f.style.display = 'block');
    } else {
        videoFields.forEach(f => f.style.display = 'none');
    }
});
</script>
{% endblock %}

